# 预编译脚本FAQ

## 语法检测逻辑

目前在开发阶段的语法检测不会阻断编译，在git commit阶段会强制阻断提交。且所有语法检测只针对scripts文件夹下的有改动的js文件。

## 常见问题

1.全局变量（cordova插件方法）未定义报错
```
/Users/xiatianhan/Coding/Tech/build/test/projectA/app/scripts/controllers/about.js
  30:17  error    'HybridOpenUrl' is not defined  no-undef
```
为了方便确认所调用的变量是否为全局变量（方法），需要将所有全局变量前加上`window.`进行显式调用。所有cordova暴露的客户端插件均绑定在window上，也需遵循此规范。

2.图片文件过大
```
ERROR:/Users/xiatianhan/Coding/Tech/build/test/projectA/app/images/1111.jpg 图片过大, 图片大小不得超过300kb
```
指定的单个图片文件大小超过限制，将会提高最后打出的Hybrid包的大小，影响用户体验。JPG图片可以使用PS的导出功能调整图片品质，进行合理压缩。PNG图片可以通过PS导出后使用http://compresspng.com/等在线工具进行二次压缩（可以压缩2/3左右）。

3.angular隐式注入warning
```
/Users/xiatianhan/Coding/Tech/build/test/projectA/app/scripts/controllers/about.js
  11:30  warning  You should use the array syntax for DI  angular/di
```
代码在prod、beta预编译阶段将会进行压缩，所以angular模块的依赖必须使用数组形式显式声明，否则发布之后会报错。当然使用Controller.$inject的方式注入也可以，不过由于组件功能所限依然会报出warning，使用$inject的同学可以无视此warning。

4.在app.js里require了第三方js库（如promise），结果报了成吨的error、warning
目前预编译脚本只会检查scripts文件夹中的js代码的代码规范。针对第三方库，可以在app文件夹下新建一个libs文件夹专门用来存放第三方代码，然后在app.js中进行require。这样就可以避免对第三方js库进行不必要的代码检查，并更好地区分模块代码和第三方代码。

5.使用ES6及Async
目前编译脚本已键入babel的ES2015、stage-3、async支持。针对app.js、及其中require的以*.es后缀的代码进行转换。